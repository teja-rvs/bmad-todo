# Epic 7 Retrospective — Docker and local orchestration

**Date:** 2026-02-19  
**Epic:** 7 — Docker and local orchestration  
**Project:** bmad-todo  
**Facilitator:** Bob (Scrum Master)

---

## 1. Epic summary and metrics

| Metric | Value |
|--------|--------|
| Total stories | 4 |
| Completed | 4 |
| Completion | 100% |
| Blockers | 0 |
| Technical debt items (called out) | 0 |

**Stories delivered:**
- 7.1 — Backend Dockerfile: multistage build and non-root user
- 7.2 — Frontend Dockerfile: multistage build and non-root user
- 7.3 — Docker Compose base and health checks
- 7.4 — Compose override files and environment configuration

**Business outcomes:** Full stack (client, API, PostgreSQL) runs via Docker and Docker Compose with multistage builds, non-root containers, health checks, and dev/test overrides. README and `.env.example` document how to run and which env vars are required.

---

## 2. Deep story analysis — patterns

### 2.1 Dev notes and implementation

- **7.1:** Backend Dockerfile with build + final stages; non-root user `app` (1000:1000); optional `bin/docker-entrypoint` for `db:migrate`. Code review caught entrypoint condition for default CMD ($1/$2) and Dockerfile comments (DATABASE_URL, bootsnap). GET /tasks Content-Type assertion added in integration test.
- **7.2:** Frontend Dockerfile mirrored 7.1 pattern: build stage (Node, npm ci, vite build), final stage (nginx:alpine, non-root `webuser`, port 8080). Custom nginx.conf for SPA fallback. Code review: File List missing `e2e/real-api.spec.ts`; recommended `.dockerignore`, README Docker section, nginx /health header order.
- **7.3:** Base `docker-compose.yml` with `db`, `api`, `client`; `pg_isready` and `curl -f http://localhost:3000/up` health checks; API `depends_on: db: condition: service_healthy`; root `.dockerignore`. Code review (adversarial): SECRET_KEY_BASE hardcoded (HIGH); client `depends_on` without `condition: service_healthy`; production DB config and credentials in compose (MEDIUM). All fixed in follow-up.
- **7.4:** `docker-compose.dev.yml` and `docker-compose.test.yml`; client `VITE_API_URL` via build arg; root `.env.example`; README Docker and env docs. Code review: README postgres→db, “profile”→“override file”; e2e spec added to File List.

### 2.2 Review feedback patterns

- **File List / documentation:** 7.1, 7.2, and 7.4 had code review findings about File List completeness (e.g. e2e/real-api.spec.ts, changed files not listed). Keeping File List and completion notes up to date before review reduces churn.
- **Security and config:** 7.3 review stressed SECRET_KEY_BASE from env (no default), no hardcoded credentials in compose, production DB via `ENV.fetch("DATABASE_URL")`. Pattern: security and env config should be explicit in DoD for infra stories.
- **Compose semantics:** client `depends_on: api` with `condition: service_healthy` (7.3) and correct service names (e.g. `db` not `postgres` in README) were caught in review. DoD for Compose stories can call out `depends_on` conditions and service naming.

### 2.3 Lessons learned

1. **Story-to-story reuse** — 7.2 mirrored 7.1 (multistage, non-root, COPY --chown); 7.3 built on 7.1/7.2; 7.4 extended 7.3. Clear ordering and “previous story intelligence” in dev notes kept implementation consistent.
2. **Code review value** — File List, SECRET_KEY_BASE, depends_on conditions, and production DB config were improved in review. Making these explicit in DoD (e.g. “File List complete,” “no secrets in compose”) would catch them before review.
3. **Adversarial review** — 7.3’s adversarial code review surfaced production concerns (SECRET_KEY_BASE, credentials) that might otherwise have shipped. Useful for infra/security-sensitive stories.

### 2.4 Technical debt and testing

- **Technical debt:** None explicitly called out. Optional items (e.g. smoke tests for Docker) documented in stories.
- **Testing:** Manual verification for build/run and Compose; RSpec and Vitest suites pass. `e2e/real-api.spec.ts` (7.2, 7.4) uses `VITE_API_URL` for Docker/CI. No new unit tests required for Dockerfile/Compose themselves.

---

## 3. Previous retrospective follow-through (Epic 6)

| Commitment (Epic 6) | Epic 7 follow-through |
|---------------------|------------------------|
| DoD: retry-path test coverage | N/A (Epic 7 did not add retry behavior) |
| DoD: user-facing error consistency | N/A (Epic 7 infra only) |
| Code review before done | ✅ All four stories (7.1–7.4) had code review before done |
| E2E and file lists in DoD | ✅ File lists updated; e2e/real-api.spec.ts in File List where relevant |

**Conclusion:** Process commitments (code review, file lists) were followed. Feature-specific DoD items (retry, error messages) were not applicable to Epic 7.

---

## 4. Next epic preview

Epic 8 is not defined in the planning artifacts. No dependencies or preparation tasks to record for a next epic. Lessons from this retro apply when the next epic is planned.

---

## 5. Action items and commitments

### Process

1. **DoD: File List and completion notes**  
   Before marking a story ready for review, ensure the story’s File List and completion notes include every modified or new file (including tests and config).  
   Owner: Dev. Success: No code review finding of “file changed but not in story File List.”

2. **DoD: infra/Compose security and env**  
   For stories that add or change Docker Compose or env config: (a) no hardcoded secrets (use env and `.env.example`); (b) production config uses env (e.g. `ENV.fetch("DATABASE_URL")`); (c) `depends_on` with `condition: service_healthy` where ordering matters.  
   Owner: Dev. Success: Review does not flag secret or config issues.

### Technical

- No new technical debt from Epic 7.

### Documentation

- README and `.env.example` already document Docker and env (7.3, 7.4). Keep them in sync when adding new env vars or compose options.

### Team agreements

- Keep code review before done.
- Keep File List and completion notes complete before review.
- For infra/security-sensitive stories, consider adversarial or security-focused review.

---

## 6. Readiness assessment

| Area | Status |
|------|--------|
| Testing & quality | Manual Docker/Compose verification; RSpec and Vitest pass; e2e/real-api for client. |
| Deployment | Not run in this retro; per project, deploy TBD. |
| Stakeholder acceptance | Per PRD, personal use; no formal sign-off required for MVP. |
| Technical health | Stable; multistage, non-root, health checks and overrides in place. |
| Unresolved blockers | None. |

**Conclusion:** Epic 7 is complete from a story and quality perspective. No critical path items (no next epic defined).

---

## 7. Key takeaways

1. **Consistent Docker pattern** — Multistage builds and non-root users were applied consistently across API and client; Compose and overrides built on that base. Architecture and “previous story intelligence” supported this.
2. **Code review caught important gaps** — File List completeness, SECRET_KEY_BASE, depends_on conditions, and production DB config were fixed in review. DoD can encode these so they’re done before review.
3. **Epic 7 is complete** — Docker and local orchestration are implemented and documented. No significant discoveries requiring epic re-plan. When Epic 8 (or later) is defined, use this retro for DoD and process.

---

**Retrospective complete.**  
Next: When the next epic is defined, ensure action items above are reflected in story workflow and DoD.
